

docker exec -ti cassandra cqlsh


how do i know the transaction was not already processed...

when a transaction is processed send an update out via kafka to go update the user's point totals

listen for those kafka transaction updates and then query the user's status

...a transaction summary event...? that lets me stop searching past a certian point because we already know what has been calculated before then

we can also have the business rules
for every transaction
for every member
for every coupon use
for every point redeemed


DROP KEYSPACE IF EXISTS users;
DROP KEYSPACE IF EXISTS wallets;
DROP KEYSPACE IF EXISTS transactions;

CREATE KEYSPACE IF NOT EXISTS users
WITH REPLICATION = {'class' : 'SimpleStrategy','replication_factor' : 1};

CREATE TABLE users.usernames (
    username text PRIMARY KEY,
    userId text
);

CREATE TABLE users.user_ids (
    userId text PRIMARY KEY
);

CREATE KEYSPACE IF NOT EXISTS wallets
WITH REPLICATION = {'class' : 'SimpleStrategy','replication_factor' : 1};

CREATE TABLE wallets.user_id_by_card_number (
    cardNumber text PRIMARY KEY,
    userId text
);

CREATE TABLE wallets.user_id_by_points (
    userId text PRIMARY KEY,
    points text
);

CREATE KEYSPACE IF NOT EXISTS transactions
WITH REPLICATION = {'class' : 'SimpleStrategy','replication_factor' : 1};

CREATE TABLE transactions.transactions (
    userId text,
    date text,
    time timeuuid,
    transactionId text,
    amountInPennies int,
    PRIMARY KEY((userId, date), timestamp)
);






